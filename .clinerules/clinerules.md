The `clinerules.md` has been updated to include mandatory file naming conventions.

FILE: .clinerules/clinerules.md
================================================
CodeIgniter 4 Production Deployment Rules & Workflow

 1\. AI Agent Workflow

1.  Analyze Request: Deconstruct user requests into logical, sequential file modifications that align with the CodeIgniter 4 file structure.
2.  Propose Changes: Before implementation, clearly state the intended modifications and the files to be affected.
3.  Adhere to Architectural Principles: All modifications must respect the CodeIgniter 4 file structure and its separation of concerns.
       Configuration (app/Config/): Manage all core application settings in their respective configuration files. Access values using the config() function.
       Controllers (app/Controllers/): Keep controllers lean and focused on request/response flow. Delegate all business logic to Models or Libraries/Services.
       Models (app/Models/): Manage all database interactions through Models, Query Builder, or Entities. Never place direct database queries in Controllers. Import all models using a `use` statement and instantiate them with their short class name (e.g., `new User()`) rather than a fully qualified namespace.
       Views (app/Views/): Handle presentation with minimal PHP. Escape all dynamic data with esc() to prevent XSS attacks. Use View Layouts for page structure and View Cells for reusable components. An entire view file's content must not be wrapped in <![CDATA[...]]> tags.
       Database (app/Database/): Manage all schema changes through Migration files and initial data with Seeder files.
       Filters (app/Filters/): Use filters only for cross-cutting concerns like security (CSRF), authentication, or rate limiting.
       Routing (app/Config/Routes.php): Define all application routes with a named route using the ['as' => 'routename'] parameter. Distinguish between client-side and server-side URL generation:
       - Client-Side (Views): For all client-side links (e.g., in `<a>` tags), generate URLs using `url_to('routename')`. This ensures that links remain consistent and maintainable.
       - Server-Side (Controllers): For all server-side redirects (e.g., after a form submission), use `redirect()->to(url_to('routename'))`. This combines the redirect functionality with the maintainability of named routes.
       Helpers (app/Helpers/): Contain only stateless, procedural helper functions.
       Language (app/Language/): Store all language-specific strings for internationalization.
       Libraries/Services (app/Libraries/, app/Config/Services.php): House reusable application logic as classes and manage them as Services for scalability and testability.
4.  Prioritize Framework Functions: Exhaust all built-in CodeIgniter functionalities before writing custom code.
5.  File Generation & Modification:
       **File Naming Conventions:** Adhere strictly to the following naming conventions. Suffixes are mandatory where specified.
       - **Controllers:** `PascalCaseController.php` (e.g., `UserController.php`). Exception: `BaseController.php`.
       - **Models:** `PascalCaseModel.php` (e.g., `UserModel.php`).
       - **Entities:** `PascalCase.php` (e.g., `User.php`).
       - **Libraries/Services:** `PascalCaseService.php` (e.g., `PaymentService.php`).
       - **Views:** Grouped in a subdirectory named after the controller in `lowercase`. File names should be descriptive `snake_case.php`.
       - **Migrations & Seeds:** Use the timestamp-prefixed, `PascalCase` format generated by `php spark`.
       File Creation: Generate all boilerplate files (Controllers, Models, Migrations, Seeds, Entities) using the appropriate php spark make: command. Manual creation is forbidden.
       Preserve Boilerplate: Do not alter the file structure, class name, namespace, or boilerplate methods generated by php spark.
       File Modification: When providing code, specify the full path from the project root (e.g., FILE: app/Controllers/Home.php) and provide the complete, updated file content.
6.  Final Confirmation: Confirm all changes have been applied in accordance with established rules before concluding.

 2\. Environment Configuration

1.  Set the CIENVIRONMENT variable in the .env file to production.
2.  The production .env file must not be committed to version control; use a template file (env) as a placeholder.
3.  Define all environment-specific variables (credentials, keys) in the .env file and access them via env().
4.  Set the application's base URL (app.baseURL) in the .env file with a trailing slash.
5.  Configure architectural settings (filters, modules, validation) directly in the relevant app/Config/ files, not the .env file.

 3\. Web Server & Filesystem

1.  Point the web server's document root to the project's /public directory.
2.  The app, system, and writable directories must be located outside the web server's document root.
3.  Grant write permissions on the writable directory and its subdirectories to the web server user.
4.  Remove all development-only files and directories (tests/, phpunit.xml.dist, spark) from the production server.

 4\. Code & Dependency Management

1.  Before deployment, execute composer install --no-dev --optimize-autoloader.
2.  Disable all unused modules in app/Config/Modules.php.
3.  Adhere to the PSR-12 coding standard and use modern PHP features like strict types, typed properties, and return type declarations.
4.  Use CodeIgniterâ€™s API Response Trait to standardize all API responses.

 5\. Error Handling & Logging

1.  Disable detailed error reporting to the browser.
2.  Enable exception logging by setting $log to true in app/Config/Exceptions.php.
3.  Configure the logging threshold in app/Config/Logger.php to an appropriate level for production (e.g., 4 for errors).
4.  Create custom error pages for common HTTP status codes in app/Views/errors/html/.
5.  **PHP Extension Checks**: When a specific PHP extension is required for a feature, include a check to ensure the extension is loaded. If it is not, log an error message to assist with debugging in new deployment instances. For example:
    ```php
    // Check if bcmath extension is loaded for precise calculations
    if (!extension_loaded('bcmath')) {
        log_message('error', 'bcmath extension is not loaded. Balance calculations may be inaccurate.');
        // Optionally, you could return an error response here if this is critical
        // return redirect()->back()->with('error', 'Server configuration error: Missing bcmath extension.');
    }
    ```

 6\. Performance Optimization

1.  If all routes are explicitly defined, disable auto-routing by setting $autoRoute to false.
2.  Enable and configure a production-ready caching driver (Redis or Memcached) in app/Config/Cache.php for frequently accessed data.
3.  Use the php spark optimize command in the deployment script to cache configuration and file locations.
4.  Optimize database queries by selecting only necessary columns and avoiding findAll() where a more specific method can be used.

 7\. Security Mandates

1.  Enable Cross-Site Request Forgery (CSRF) protection globally.
2.  Enable and configure a Content Security Policy (CSP).
3.  Use the Query Builder or prepared statements for all database queries. Raw queries are forbidden.
4.  Validate all user-submitted data ($GET, $POST, etc.) with the Validation library before processing.
5.  Escape all data rendered in HTML views using the esc() function. Do not use CDATA sections.
6.  For HTTPS, set cookie.secure and cookie.httponly to true and store session data in a database.
7.  Enable and configure the Throttler filter on authentication and other sensitive routes to prevent brute-force attacks.

 8\. Development & Testing

1.  Accompany all new business logic in models, libraries, or services with corresponding unit and feature tests.

 9\. Authentication

1.  Keep authentication controllers concise, delegating persistence to models.
2.  Use CodeIgniter's form helper for all forms.
3.  Manage user state with session()->set() for login and session()->destroy() for logout.
4.  Use passwordhash() for storing passwords and passwordverify() for checking them.
5.  Use redirect()->to() for navigation after authentication actions.
6.  Provide clear validation feedback and repopulate form fields on submission errors.
7.  Use session flashdata for success and error messages.
8.  Conditionally render navigation links based on the user's authentication status.

 10\. Database Migrations

1.  Generate all migration files using php spark make:migration.
2.  Define table schemas, constraints, and keys clearly within the up() method using forge methods.
3.  For tables with timestamps, include createdat and updatedat fields and set useTimestamps = true in the corresponding model.
4.  Keep each migration file focused on a single, logical schema change.

 9\. Flash Message Handling

1.  Centralized Display: All flash messages (e.g., success, error, info) must be rendered through a single, centralized view partial, such as `app/Views/partials/flash_messages.php`. This partial should be included in the main application layout to ensure consistent display across all pages.
2.  Standardized Keys: Use the following standardized keys when setting flashdata in controllers:
    success: For successful operations.
    error: For general errors or failures.
    warning: For non-critical issues or important notices.
    info: For informational messages.
    errors: For an array of validation errors.
3.  Controller Responsibility: Controllers are responsible for setting flashdata. This should be done using `session()->setFlashdata('key', 'message')` or, when redirecting, the `with('key', 'message')` method.
4.  View Responsibility: Individual views must not contain logic for displaying flash messages. This responsibility is delegated entirely to the centralized partial. Data that is not a simple alert message (e.g., a complex query result) may be handled within its specific view.

 URL References

   Application Structure: https://codeigniter.com/userguide/concepts/structure.html
   API Responses: https://codeigniter.com/userguide/outgoing/apiresponses.html
   Caching: https://codeigniter.com/userguide/libraries/caching.html
   CLI Generators: https://codeigniter.com/userguide/cli/cligenerators.html
   Configuration: https://codeigniter.com/userguide/general/configuration.html
   Content Security Policy (CSP): https://codeigniter.com/userguide/outgoing/csp.html
   Controllers: https://codeigniter.com/userguide/incoming/controllers.html
   Deployment: https://codeigniter.com/userguide/installation/deployment.html
   Entities: https://codeigniter.com/userguide/models/entities.html
   Environments: https://codeigniter.com/userguide/general/environments.html
   Error Handling: https://codeigniter.com/userguide/general/errors.html
   Filters: https://codeigniter.com/userguide/incoming/filters.html
   Helpers: https://codeigniter.com/userguide/general/helpers.html
   Localization: https://codeigniter.com/userguide/outgoing/localization.html
   Logging: https://codeigniter.com/userguide/general/logging.html
   Migrations: https://codeigniter.com/userguide/dbmgmt/migration.html
   Models: https://codeigniter.com/userguide/models/model.html
   Modules: https://codeigniter.com/userguide/general/modules.html
   PSR Standards: https://codeigniter.com/userguide/intro/psr.html
   Query Builder: https://codeigniter.com/userguide/database/querybuilder.html
   Routing: https://codeigniter.com/userguide/incoming/routing.html
   Security: https://codeigniter.com/userguide/libraries/security.html
   Seeding: https://codeigniter.com/userguide/dbmgmt/seeding.html
   Services: https://codeigniter.com/userguide/concepts/services.html
   Sessions: https://codeigniter.com/userguide/libraries/sessions.html
   Testing: https://codeigniter.com/userguide/testing/index.html
   Throttler: https://codeigniter.com/userguide/libraries/throttler.html
   Validation: https://codeigniter.com/userguide/libraries/validation.html
   View Cells: https://codeigniter.com/userguide/outgoing/viewcells.html
   View Layouts: https://codeigniter.com/userguide/outgoing/viewlayouts.html
